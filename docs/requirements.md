# PawapokeEventMaker 要求定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
PawapokeEventMaker（パワポケイベントメーカー）

### 1.2 目的
ノベルゲーム「pawapoke-MFver」で使用するイベント（キャラクターとセリフと画像が表示される一連の流れ）を、非エンジニアでも簡単に作成・編集できるツールを提供する。

### 1.3 背景
- 既存のイベントデータは `dialogs.js` に直接コードとして記述されている
- イベントを追加・編集するにはJavaScriptの知識が必要
- より直感的なUIでイベントを作成できるツールが必要

### 1.4 対象ユーザー
- ノベルゲームのコンテンツ制作者
- エンジニアではないが、イベントを作成したいユーザー

---

## 2. 用語定義

| 用語 | 定義 |
|------|------|
| イベント | キャラクターとセリフと画像が表示される一連の流れ。複数のセリフから構成される |
| セリフ | 1つの発言単位。テキスト、話者（左/右）、画像パスを含む |
| 話者 | セリフを発言するキャラクターの位置（left/right） |
| 選択肢 | プレイヤーが選ぶことができるオプション。各選択肢に対応するイベントが存在する |

---

## 3. 機能要件

### 3.1 イベント管理機能

#### REQ-001: イベントの作成
- **要件**: ユーザーは新しいイベントを作成できる
- **詳細**:
  - イベントID（選択肢キー）は自動生成される（ランダム生成、重複チェック付き）
  - 初期状態で空のセリフが1つ追加される
  - ユーザーはイベント名のみを入力する
- **入力**: イベント名（文字列、任意）
- **出力**: 新規イベントオブジェクト（自動生成されたイベントIDを含む）
- **優先度**: 高
- **備考**: イベントIDは英数字、アンダースコア、ハイフンで構成され、一意性が保証される

#### REQ-002: イベントの編集
- **要件**: ユーザーは既存のイベントを編集できる
- **詳細**:
  - イベント名の変更（イベントIDは変更不可。理由: イベントIDは選択肢キーとして使用され、変更すると既存の参照が壊れるため）
  - セリフの追加・削除・順序変更
  - 各セリフの内容編集
- **入力**: イベントID、編集内容
- **出力**: 更新されたイベントオブジェクト
- **優先度**: 高
- **備考**: イベントIDは作成時に設定され、後から変更することはできない。新しいIDが必要な場合は新規イベントとして作成する

#### REQ-003: イベントの削除
- **要件**: ユーザーは不要なイベントを削除できる
- **詳細**:
  - 削除前に確認ダイアログを表示
  - 削除後はイベント一覧から除外される
- **入力**: イベントID
- **出力**: なし（イベントが削除される）
- **優先度**: 中

#### REQ-004: イベント一覧の表示
- **要件**: ユーザーは作成済みのイベント一覧を確認できる
- **詳細**:
  - イベントID、イベント名を表示
  - クリックで編集画面に遷移
- **入力**: なし
- **出力**: イベント一覧（ID、イベント名）
- **優先度**: 高

### 3.2 セリフ管理機能

#### REQ-005: セリフの追加
- **要件**: ユーザーはイベント内に新しいセリフを追加できる
- **詳細**:
  - セリフはイベント内の任意の位置に追加可能
  - 追加時はデフォルト値（空のテキスト、left話者、デフォルト画像）が設定される
- **入力**: 追加位置（先頭/末尾/指定位置の後）
- **出力**: 新規セリフオブジェクト
- **優先度**: 高

#### REQ-006: セリフの編集
- **要件**: ユーザーはセリフの内容を編集できる
- **詳細**:
  - テキスト内容の編集
  - 話者の選択（left/right）
  - 画像パスの指定
- **入力**: セリフID、編集内容
- **出力**: 更新されたセリフオブジェクト
- **優先度**: 高

#### REQ-007: セリフの削除
- **要件**: ユーザーは不要なセリフを削除できる
- **詳細**:
  - 削除前に確認を求める（任意）
  - イベント内の最後のセリフは削除できない（最低1つは必要）
- **入力**: セリフID
- **出力**: なし（セリフが削除される）
- **優先度**: 中

#### REQ-008: セリフの順序変更
- **要件**: ユーザーはセリフの表示順序を変更できる
- **詳細**:
  - ドラッグ&ドロップまたは上下矢印ボタンで順序変更
- **入力**: セリフID、移動先位置
- **出力**: 順序が更新されたイベント
- **優先度**: 中

### 3.3 データ管理機能

#### REQ-009: データの保存
- **要件**: ユーザーは作成・編集したイベントデータを保存できる
- **詳細**:
  - データベース、ローカルストレージ、またはファイルとして保存
  - JSON形式で保存
  - 既存の `dialogs.js` 形式にもエクスポート可能
  - データベース使用時は、Vercel環境で使用できる無料のDB（Supabase、Vercel Postgres、Neon等）、Googleスプレッドシート、Notionのデータベースを検討
  - **保存タイミング**: 保存ボタンを押した時のみAPIを呼び出して保存（編集操作中はメモリ上で保持）
  - 編集操作（セリフ追加・削除・更新、イベント名変更など）は即座にAPIを呼び出さず、メモリ上のデータに対して行う
  - 未保存の変更がある場合は、一覧に戻る前に警告を表示
- **入力**: イベントデータ全体
- **出力**: 保存されたデータ（データベース、ファイル、またはローカルストレージ）
- **優先度**: 高

#### REQ-010: データの読み込み
- **要件**: ユーザーは保存済みのイベントデータを読み込める
- **詳細**:
  - データベース、JSONファイル、または `dialogs.js` ファイルから読み込み
  - 既存の `dialogs.js` をインポートして編集可能にする
  - データベース使用時は、Vercel環境で使用できる無料のDB（Supabase、Vercel Postgres、Neon等）、Googleスプレッドシート、Notionのデータベースから読み込み可能
- **入力**: データベース接続情報、データファイル、または `dialogs.js` ファイル
- **出力**: イベントデータオブジェクト
- **優先度**: 高

#### REQ-011: dialogs.js形式へのエクスポート
- **要件**: ユーザーは作成したイベントを `dialogs.js` 形式でエクスポートできる
- **詳細**:
  - 既存の `dialogs.js` の形式に準拠したコードを生成
  - コピー&ペーストまたはファイルダウンロードで提供
- **入力**: イベントデータ全体
- **出力**: `dialogs.js` 形式のコード
- **優先度**: 高

### 3.4 プレビュー機能

#### REQ-012: リアルタイムプレビュー
- **要件**: ユーザーは編集中のイベントをリアルタイムでプレビューできる
- **詳細**:
  - 実際のゲーム画面と同様の表示
  - タイプライターアニメーションの確認
  - キャラクター画像の表示確認
- **入力**: イベントデータ
- **出力**: プレビュー画面
- **優先度**: 中

#### REQ-013: プレビュー実行
- **要件**: ユーザーは作成したイベントを実際に実行して確認できる
- **詳細**:
  - プレビューボタンでイベントを実行
  - セリフが順番に表示される
  - 画像の切り替えも確認できる
  - **画面レイアウト**: ヘッダー → ゲーム画面（背景＋キャラクター） → セリフエリア → 操作ボタンの順に配置
  - **キャラクター画像のサイズ調整**: 画像ファイルのサイズがまばらでも、画面UI側で固定サイズ（400px × 400px）に統一して表示する。`object-fit: contain` を使用してアスペクト比を保持しながら表示する
- **入力**: イベントデータ
- **出力**: 実行中のプレビュー
- **優先度**: 中

### 3.5 UI/UX要件

#### REQ-014: 直感的な操作
- **要件**: エンジニアでないユーザーでも直感的に操作できる
- **詳細**:
  - 明確なラベルと説明
  - エラーメッセージは分かりやすい日本語で表示
  - 操作手順が明確
- **優先度**: 高

#### REQ-015: レスポンシブデザイン
- **要件**: デスクトップ、タブレット、スマートフォン（iPhone、Android）で快適に使用できる
- **詳細**:
  - デスクトップ: 1024px以上
  - タブレット: 768px以上1024px未満
  - スマートフォン: 320px以上768px未満（iPhone、Android対応）
  - ネイティブアプリ実装は行わない（Webアプリケーションとして提供）
- **優先度**: 中

---

## 4. 非機能要件

### 4.1 パフォーマンス

#### NFR-001: レスポンス時間
- **要件**: 操作に対する応答時間は1秒以内
- **詳細**: セリフの追加・削除・編集操作
- **優先度**: 中

#### NFR-002: データ容量
- **要件**: 100イベント、各イベント50セリフまで対応
- **詳細**: メモリ使用量を考慮
- **優先度**: 低

### 4.2 互換性

#### NFR-003: ブラウザ対応
- **要件**: 最新版のChrome、Firefox、Edge、Safariで動作
- **詳細**: ES6+対応ブラウザ
- **優先度**: 高

#### NFR-004: 既存データとの互換性
- **要件**: 既存の `dialogs.js` を読み込んで編集可能
- **詳細**: 
  - 既存のデータ構造を完全にサポート
  - データベース、スプレッドシート、Notionから読み込んだデータも `dialogs.js` 形式にエクスポート可能
- **優先度**: 高

### 4.3 セキュリティ

#### NFR-005: データ保護
- **要件**: データの安全性とプライバシーを保護する
- **詳細**: 
  - データベース使用時は、適切な認証・認可を実装
  - データベース接続情報は環境変数で管理
  - ユーザーデータは暗号化して保存（必要に応じて）
  - 外部サーバーに送信する場合は、HTTPS通信を使用
- **優先度**: 高

### 4.4 保守性

#### NFR-006: コード品質
- **要件**: 可読性の高いコード、適切なコメント
- **詳細**: 
  - 『リーダブルコード』の基準を参考にする
  - 明確な命名、簡潔な関数、適切なコメント、一貫性の維持
  - 将来の機能追加を考慮した設計
  - 参照: `docs/readable-code-guidelines.md`
- **優先度**: 中

---

## 5. データモデル

### 5.1 イベントデータ構造

```javascript
{
  [eventId: string]: Array<{
    text: string;        // セリフのテキスト
    speaker: "left" | "right";  // 話者の位置
    imagePath: string;   // 画像ファイルのパス
  }>
}
```

### 5.2 セリフオブジェクト

| フィールド | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| text | string | 必須 | セリフのテキスト内容 |
| speaker | "left" \| "right" | 必須 | 話者の位置 |
| imagePath | string | 必須 | 画像ファイルのパス（相対パス） |

### 5.3 イベントメタデータ（内部管理用）

```javascript
{
  id: string;           // イベントID（選択肢キー、変更不可）
  name: string;         // 表示名（任意、変更可能）
  createdAt: Date;      // 作成日時
  updatedAt: Date;      // 更新日時
}
```

---

## 6. 画面要件

### 6.1 イベント一覧画面
- **機能**: 作成済みイベントの一覧表示
- **要素**:
  - イベント一覧（ID、イベント名）
  - 新規作成ボタン
  - 編集ボタン
  - 削除ボタン

### 6.2 イベント編集画面
- **機能**: イベントの作成・編集
- **要素**:
  - イベントID表示欄（自動生成、表示のみ、編集不可）
  - イベント名入力欄
  - セリフ一覧（順序変更可能）
  - セリフ追加ボタン
  - 各セリフの編集フォーム
  - プレビューエリア
  - 保存ボタン（編集内容をデータベースに保存）
  - キャンセルボタン（未保存の変更がある場合は警告を表示）
  - 未保存の変更がある場合の表示（オプション）

### 6.3 セリフ編集フォーム
- **機能**: 個別セリフの編集
- **要素**:
  - テキスト入力欄（テキストエリア）
  - 話者選択（ラジオボタン: left/right）
  - 画像パス入力欄（ファイル選択または手入力）
  - 削除ボタン
  - 順序変更ボタン（上/下）

---

## 7. 入力・出力要件

### 7.1 入力

#### 7.1.1 イベントID
- **形式**: 文字列（英数字、アンダースコア、ハイフン）
- **生成方法**: 自動生成（ランダム生成、UUIDまたは同様の方式）
- **制約**: 
  - 自動生成されるため、ユーザー入力は不要
  - 1文字以上50文字以内
  - 重複不可（生成時に重複チェックを実施）
- **備考**: イベントIDは作成時に自動生成され、後から変更することはできない

#### 7.1.2 イベント名
- **形式**: 文字列
- **制約**:
  - 任意（未入力の場合はデフォルト名を使用）
  - 1文字以上100文字以内

#### 7.1.3 セリフテキスト
- **形式**: 文字列
- **制約**:
  - 必須
  - 1文字以上1000文字以内

#### 7.1.4 話者
- **形式**: "left" または "right"
- **制約**: 必須

#### 7.1.5 画像パス
- **形式**: 文字列（相対パス）
- **制約**:
  - 必須
  - 有効な画像ファイルパス
  - 例: `./img/character.gif`

### 7.2 出力

#### 7.2.1 dialogs.js形式
- **形式**: JavaScriptコード
- **構造**: 既存の `dialogs.js` と同一形式
- **例**:
```javascript
export const dialogs = {
  eventId: [
    { text: "セリフ1", speaker: "left", imagePath: "./img/image1.gif" },
    { text: "セリフ2", speaker: "right", imagePath: "./img/image2.gif" }
  ]
};
```

#### 7.2.2 JSON形式
- **形式**: JSON
- **構造**: イベントデータ構造に準拠

---

## 8. 制約事項

### 8.1 技術的制約
- クライアントサイドのみで動作（サーバー不要）
- 既存の `pawapoke-MFver` プロジェクトとの互換性を維持
- 既存の `dialogs.js` の構造を変更しない

### 8.2 ビジネス制約
- 開発期間: 未定
- 予算: なし（個人プロジェクト）

---

## 9. テスト要件（参照用）

### 9.1 機能テスト
- 各機能要件（REQ-001 ～ REQ-015）に対するテストケースを作成
- 正常系・異常系・境界値テストを実施

### 9.2 互換性テスト
- 既存の `dialogs.js` の読み込み・エクスポートが正しく動作することを確認
- 各ブラウザでの動作確認

### 9.3 UI/UXテスト
- 直感的な操作が可能か確認
- エラーメッセージが分かりやすいか確認

---

## 10. 今後の拡張可能性

### 10.1 将来追加可能な機能
- 画像のアップロード機能
- テンプレート機能
- バージョン管理機能
- 複数イベントの一括編集
- 検索・フィルタ機能

---

## 11. 変更履歴

| 日付 | バージョン | 変更内容 | 変更者 |
|------|-----------|---------|--------|
| 2025-12-13 | 1.0 | 初版作成 | - |

